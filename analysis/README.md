# ðŸ“Š Pepcitrus UNICAMP 2025: Simulation Data Analysis and Visualization

![Language: Python](https://img.shields.io/badge/Language-Python-blue.svg)
![Libraries: Pandas, Matplotlib, OpenCV](https://img.shields.io/badge/Libraries-Pandas%2C%20Matplotlib%2C%20OpenCV-yellow.svg)

## Abstract

This directory contains the Python script (`analyze.py`) and configuration files necessary to process and visualize the data generated by the main **Citrus Greening Cellular Automaton Model**.

The script's primary functions are:
1. Generate **time-series plots (PDF)** of average infection ($\bar{I}$) and callose ($\bar{C}$) levels.
2. Generate **spatial visualization videos (MP4)** from the frame-by-frame data providing a dynamic view of the disease and drug spread.

This tool convert raw simulation output into figures and mp4 of the simulations.


## Table of Contents

1. [Getting Started](#getting-started)
   * [Prerequisites](#prerequisites)
   * [Required Data Structure](#required-data-structure)
2. [How to Run the Analysis](#how-to-run-the-analysis)
3. [Configuration](#configuration)
   * [Editing Plot Parameters](#editing-plot-parameters)
4. [Output Files](#output-files)
5. [Code Structure](#code-structure)
6. [License & Attribution](#license--attribution)

---

## Getting Started

### Prerequisites

You need a Python 3 environment. Install the required external libraries using `pip`:

```bash
pip install pandas matplotlib numpy opencv-python tqdm
```

### Required Data Structure

The analysis script relies on the output produced by the C++ simulator being placed in the project's **root directory**.  
The following files and folders are:

| Data Type | Example File/Folder | Purpose |
| :--- | :--- | :--- |
| **Time Series Data** | `results_control.csv` | Used by `plot_data` to generate average concentration graphs. |
| **Frame Data** | `data_ctx/frame_1000.csv` | Used by `generate_simulation_video` for spatial visualization. |

Ensure these data directories (`data_control`, `data_ctx`, `data_tetra`) and CSV files are present before running the script.

---

## How to Run the Analysis

1. Navigate to the directory containing `analyze.py`:

   ```bash
   cd analysis/ 
   ```

2. Execute the script from the terminal:

   ```bash
   python analyze.py
   ```

3. The script will launch an **interactive menu**. 
   Select the scenario you wish to analyze (e.g., `ctx` or `all`). 
   The program will load the corresponding data, generate the PDF plot and create the MP4 video.

---

## Configuration

### Editing Plot Parameters

Some variables used for plot annotations (like treatment start day) are managed externally in the **`config_analysis.json`** file.  
You should edit this file to match the exact parameters used in the C++ simulation.

| Parameter Key | Description | Default Value | Usage |
| :--- | :--- | :--- | :--- |
| `"effect_window_days"` | Duration of the drug's effect window (used for Tetracycline annotation). | `150` | `plot_data` |
| `"treatment_start_day"` | The specific day the first treatment application begins. | `1000` | Used by **both** `plot_data` and `generate_simulation_video`. |
| `"num_years_treatment"` | Total number of annual treatments to display on the plot. | `4` | `plot_data` |

#### `config_analysis.json` Example

```json
{
    "effect_window_days": 150,
    "treatment_start_day": 1000,
    "num_years_treatment": 4
}
```

---

## Output Files

The script places all generated output files in the directory from which it is executed.

| Scenario | Generated Plot | Generated Video |
| :--- | :--- | :--- |
| **control** | `plot_results_control.pdf` | `simulation_control.mp4` |
| **ctx** | `plot_results_ctx.pdf` | `simulation_ctx.mp4` |
| **tetra** | `plot_results_tetra.pdf` | `simulation_tetra.mp4` |

---

## Code Structure

The `analyze.py` script is divided into clear functional blocks:

| Section | Key Functions | Description |
| :--- | :--- | :--- |
| **Utility Functions** | `load_analysis_config` | Handles reading the external `config_analysis.json`. |
| **Plotting Functions** | `load_data`, `plot_data` | Loads time-series CSVs and generates the customized Matplotlib graphs. |
| **Video Generation** | `create_video_frame_continuous`, `generate_simulation_video` | Reads frame CSVs, applies color mapping (infection, callose, drug), and compiles the MP4 video with smooth transitions. |
| **Interactive Main Loop** | `main` | Manages user input, loads data, and orchestrates the full analysis workflow. |

---

## License & Attribution

Developed by the **iGEM UNICAMP 2025 Team** ðŸ§ª  
Part of the **Pepcitrus Project**, focused on computational modeling of Citrus Greening treatment strategies.  

Â© 2025 iGEM UNICAMP.  
Licensed under the [MIT License](https://opensource.org/licenses/MIT).  
Feel free to use, modify, and distribute with proper attribution.

